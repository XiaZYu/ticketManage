<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.sessions.mapper.SessionMapper">
    <resultMap id="sessionResultMap" type="com.example.sessions.domain.vo.SessionDetail">
        <id property="sessionId" column="session_id"/>
        <result property="filmId" column="film_id"/>
        <result property="filmName" column="film_name"/>
        <result property="hallId" column="hall_id"/>
        <result property="hallName" column="hall_name"/>
        <result property="time" column="time"/>
    </resultMap>
    <select id="getSessionsByFilmId" resultMap="sessionResultMap">
        SELECT s.* , f.film_id, f.film_name, h.hall_id, h.hall_name
        FROM session s
        JOIN film f ON s.film_id = f.film_id
        JOIN hall h ON s.hall_id = h.hall_id
        <where>
            <if test="filmId != null">
                s.film_id like concat('%', #{filmId}, '%')
            </if>
        </where>
        order by s.time
        limit #{current}, #{pageSize}
    </select>
</mapper>